<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QR Scanner - Smart Mess System</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
body { font-family: 'Manrope', sans-serif; background: #F6F9F6; }
.glassmorphism {
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(12px);
}
.scan-animation { animation: scan 2s infinite; }
@keyframes scan {
    0%,100% { transform: translateY(-100%); }
    50% { transform: translateY(100%); }
}
</style>
</head>

<body class="min-h-screen">

<header class="glassmorphism shadow-lg p-4">
    <h1 class="text-xl font-bold">Scan to Take Meal</h1>
</header>

<main class="max-w-4xl mx-auto p-6">

<div class="glassmorphism rounded-2xl p-8 shadow-lg mb-6">

<h2 class="text-2xl font-bold text-center mb-6">Quick Scan</h2>

<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">

<button onclick="scanMeal(1)"
class="bg-green-600 text-white font-semibold py-4 rounded-xl hover:bg-green-700 transition">
Hostel A
</button>

<button onclick="scanMeal(2)"
class="bg-teal-600 text-white font-semibold py-4 rounded-xl hover:bg-teal-700 transition">
Hostel B
</button>

<button onclick="scanMeal(3)"
class="bg-purple-600 text-white font-semibold py-4 rounded-xl hover:bg-purple-700 transition">
Hostel C
</button>

</div>

<div id="scanResult" class="hidden p-4 rounded-xl text-center font-semibold"></div>

</div>

</main>

<script>

// Redirect if not logged in
if (!localStorage.getItem("student_id")) {
    window.location.href = "login.html";
}

async function scanMeal(messId) {

    const studentId = localStorage.getItem("student_id");
    const resultDiv = document.getElementById("scanResult");

    resultDiv.classList.remove("hidden");
    resultDiv.className = "p-4 rounded-xl text-center font-semibold bg-blue-100 text-blue-800";
    resultDiv.innerText = "Scanning...";

    try {
        const response = await fetch(
            "http://127.0.0.1:8000/scan/entry",
            {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    student_id: parseInt(studentId),
                    mess_id: messId
                })
            }
        );

        const data = await response.json();

        if (!response.ok) {
            throw new Error(data.detail || "Scan failed");
        }

        resultDiv.className = "p-4 rounded-xl text-center font-semibold bg-green-100 text-green-800";
        resultDiv.innerHTML = `
            âœ… Scan Successful! <br>
            Meal: ${data.meal_type} <br>
            Time: ${new Date().toLocaleTimeString()}
        `;

    } catch (error) {

        resultDiv.className = "p-4 rounded-xl text-center font-semibold bg-red-100 text-red-800";
        resultDiv.innerText = error.message;
    }
}

</script>

</body>
</html>
