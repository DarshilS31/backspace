<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pre-Book Meals - Smart Mess System</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
body { font-family: 'Manrope', sans-serif; background: #F6F9F6; }
.glassmorphism {
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(12px);
}
.meal-card { transition: all 0.3s ease; cursor: pointer; }
.meal-card:hover { transform: scale(1.05); }
.meal-card.selected {
    border: 3px solid #4CAF50;
    background: rgba(76, 175, 80, 0.1);
}
</style>
</head>

<body class="min-h-screen">

<header class="glassmorphism shadow-lg p-4">
    <h1 class="text-xl font-bold">Pre-Book Current Meal</h1>
</header>

<main class="max-w-4xl mx-auto p-6">

<div class="glassmorphism rounded-2xl p-8 shadow-lg">

<form id="prebookForm" class="space-y-6">

<!-- Mess Selection -->
<div>
<label class="block font-semibold mb-2">Select Mess</label>
<select id="messSelect" class="w-full p-3 border rounded-xl" required>
<option value="">Choose a mess...</option>
<option value="1">Hostel A Mess</option>
<option value="2">Hostel B Mess</option>
<option value="3">Hostel C Mess</option>
</select>
</div>

<!-- Info -->
<div class="bg-yellow-50 border border-yellow-200 p-4 rounded-xl text-sm">
⚠ This will book the current active meal only.
</div>

<button type="submit"
class="w-full bg-green-600 text-white font-bold py-3 rounded-xl hover:bg-green-700 transition">
Confirm Booking
</button>

</form>

<div id="resultMessage" class="mt-4 text-center font-semibold hidden"></div>

</div>

</main>

<script>

// Redirect if not logged in
if (!localStorage.getItem("student_id")) {
    window.location.href = "login.html";
}

document.getElementById("prebookForm").addEventListener("submit", async function(e) {
    e.preventDefault();

    const studentId = localStorage.getItem("student_id");
    const messId = document.getElementById("messSelect").value;
    const resultDiv = document.getElementById("resultMessage");

    resultDiv.classList.add("hidden");

    if (!messId) {
        alert("Please select a mess.");
        return;
    }

    try {
        const response = await fetch(
            "http://127.0.0.1:8000/booking/book",
            {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    student_id: parseInt(studentId),
                    mess_id: parseInt(messId)
                })
            }
        );

        const data = await response.json();

        if (!response.ok) {
            throw new Error(data.detail || "Booking failed");
        }

        resultDiv.innerText = "✅ Booking Successful!";
        resultDiv.classList.remove("hidden");
        resultDiv.classList.remove("text-red-600");
        resultDiv.classList.add("text-green-600");

    } catch (error) {
        resultDiv.innerText = error.message;
        resultDiv.classList.remove("hidden");
        resultDiv.classList.remove("text-green-600");
        resultDiv.classList.add("text-red-600");
    }
});

</script>

</body>
</html>
